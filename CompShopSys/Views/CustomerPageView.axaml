<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             xmlns:viewmodels="clr-namespace:TechShopMS.ViewModels"
             x:DataType="viewmodels:CustomerPageViewModel"
             x:Class="TechShopMS.Views.CustomerPageView"
             xmlns:fa="using:FluentAvalonia.UI.Controls">

	<!-- Styles remain the same -->
	<UserControl.Resources>
		<x:Double x:Key="DataGridSortIconMinWidth">0</x:Double>
	</UserControl.Resources>
	<UserControl.Styles>


		<Style Selector="DataGridColumnHeader">
			<Setter Property="FontSize" Value="8"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="FontFamily" Value="{DynamicResource DmMedium}"/>
			<Setter Property="Foreground" Value="#65758c"/>

			<Setter Property="Padding" Value="8"/>
			<Setter Property="HorizontalContentAlignment" Value="Center"/>

		</Style>
		<Style Selector="DataGrid TextBlock">
			<Setter Property="TextAlignment" Value="Center"/>
		</Style>
		<Style Selector="DataGridCell">
			<Setter Property="FontSize" Value="10"></Setter>
			<Setter Property="FontFamily" Value="{DynamicResource DmRegular}"></Setter>

		</Style>
		<Style Selector="Button">
			<Setter Property="Padding" Value="5"/>
			<Setter Property="FontSize" Value="12"/>
		</Style>

		<Style Selector="Button.danger">
			<Setter Property="Background" Value="#FF2C2C"/>
			<Setter Property="Foreground" Value="{DynamicResource PrimWhite}"/>
			<Setter Property="Padding" Value="10,5"/>
			<Setter Property="CornerRadius" Value="4"/>
		</Style>

		<Style Selector="TextBlock">
			<Setter Property="FontFamily" Value="{DynamicResource DmMedium}"/>
			<Setter Property="FontSize" Value="10"/>
			<Setter Property="Foreground" Value="{DynamicResource PrimBlack}"/>

		</Style>

		<Style Selector="TextBlock.UserForm">
			<Setter Property="FontFamily" Value="{DynamicResource DmMedium}"/>
			<Setter Property="FontSize" Value="10"/>
			<Setter Property="Foreground" Value="{DynamicResource PrimBlack}"/>
			<Setter Property="Margin" Value="0,0,0,8"></Setter>

		</Style>
		<Style Selector="TextBox.UserForm">
			<Setter Property="FontFamily" Value="{DynamicResource DmMedium}"/>
			<Setter Property="FontSize" Value="10"/>
			<Setter Property="Foreground" Value="{DynamicResource PrimBlack}"/>
			<Setter Property="Margin" Value="0,0,0,8"></Setter>
			<Setter Property="VerticalContentAlignment" Value="Center"/>
			<Setter Property="Padding" Value="5,0,0,0"/>
		</Style>

		<Style Selector="Button.success">
			<Setter Property="Background" Value="{DynamicResource SafeClr}"/>
			<Setter Property="Foreground" Value="{DynamicResource PrimWhite}"/>
			<Setter Property="FontFamily" Value="{DynamicResource DmMedium}"/>
			<Setter Property="Padding" Value="10,5"/>
			<Setter Property="CornerRadius" Value="4"/>
		</Style>


		<Style Selector="Button.primary">
			<Setter Property="Background" Value="{DynamicResource AccentClr}"/>
			<Setter Property="Foreground" Value="{DynamicResource PrimWhite}"/>
			<Setter Property="FontFamily" Value="{DynamicResource DmMedium}"/>
			<Setter Property="Padding" Value="10,5"/>
			<Setter Property="CornerRadius" Value="4"/>
		</Style>
		<Style Selector="Button.Clear">
			<Setter Property="Background" Value="{DynamicResource PrimWhite}"/>

			<Setter Property="FontFamily" Value="{DynamicResource DmMedium}"/>
			<Setter Property="Padding" Value="10,5"/>
			<Setter Property="CornerRadius" Value="4"/>
		</Style>

		<Style Selector="TextBox">
			<Setter	Property="Height" Value="20"></Setter>

			<Setter	Property="MinHeight" Value="15"></Setter>
			<Setter Property="BorderBrush" Value="{DynamicResource Gray200}"/>
			<Setter Property="Padding" Value="0"/>
			<Setter Property="FontSize" Value="8"/>
			<Setter Property="CornerRadius" Value="3"></Setter>

		</Style>
		<Style Selector="TextBox:pointerover">
			<Setter Property="BorderBrush" Value="{DynamicResource AccentClr}"/>
		</Style>

		<Style Selector="DataGridColumnHeader /template/ fa|FontIcon#SortIcon">
			<Setter Property="Foreground" Value="{DynamicResource PrimBlack}"/>
			<Setter Property="FontSize" Value="10"/>

		</Style>
		<Style Selector="DataGridColumnHeader:sortascending /template/ fa|FontIcon#SortIcon">

			<Setter Property="FontSize" Value="10"/>
		</Style>

		<Style Selector="DataGridColumnHeader:sortdescending /template/ fa|FontIcon#SortIcon">
			<Setter Property="FontSize" Value="10"/>

		</Style>


		<Style Selector="DataGridColumnHeader TextBlock.Wrap">
			<Setter Property="TextWrapping" Value="Wrap"/>
			<Setter Property="HorizontalAlignment" Value="Center"/>
			<Setter Property="VerticalAlignment" Value="Center"/>
			<Setter Property="TextAlignment" Value="Center"/>
			<Setter Property="Margin" Value="4"/>
		</Style>


	</UserControl.Styles>

	<StackPanel Margin="20">
		<!-- Search & Pagination -->
		<StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch" Margin="0,0,0,15" Spacing="10">
			<TextBox Watermark="Search customers..."
                     Text="{Binding SearchQuery, Mode=TwoWay}"
                     Width="300"
                     FontSize="12"
                     HorizontalAlignment="Center"
                     Margin="20,0"/>
			
			<TextBlock Text="{Binding CurrentPage}" />
			<TextBlock Text=" / " />
			<TextBlock Text="{Binding TotalPages}" />
			<Button Content="Prev" Command="{Binding PreviousPageCommand}" />
			<Button Content="Next" Command="{Binding NextPageCommand}" />
		</StackPanel>

		<Grid ColumnDefinitions="3*,*">
			<!-- Data Grid -->
			<Border BoxShadow="0 3 8 0 #3D000000" Grid.Column="0" Margin="20" CornerRadius="10">
				<DataGrid ItemsSource="{Binding PagedCustomers}"
                          AutoGenerateColumns="False"
                          SelectedItem="{Binding SelectedCustomer, Mode=TwoWay}"
                          FontSize="16"
						 
                          HorizontalAlignment="Stretch"
                          GridLinesVisibility="All"
                          FontFamily="{DynamicResource DmRegular}"
                          IsReadOnly="True">
					
					<DataGrid.Columns>
						<DataGridTextColumn Header="Date Created" Binding="{Binding DateCreated, StringFormat={}{0:yyyy-MM-dd}}"  Width="1*" />
						<DataGridTextColumn Header="Id" Binding="{Binding Id}" IsVisible="False" />
						<DataGridTextColumn Header="First Name" Binding="{Binding FirstName}" Width="*" />
						
						<DataGridTextColumn Header="Last Name" Binding="{Binding LastName}" Width="*" />
						<DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="1.5*" />
						<DataGridTextColumn Header="Phone" Binding="{Binding ContactNumber}" Width="*" />
						<DataGridTextColumn Header="Address" Binding="{Binding Address}" Width="2*" />
						<DataGridTextColumn Header="Active" Binding="{Binding IsActive}" Width="*" />

						<DataGridTemplateColumn 
												
												Width="*">
							<DataGridTemplateColumn.HeaderTemplate>
								<DataTemplate>
									<TextBlock Text="Purchase History"
											   
											   TextWrapping="Wrap"
											   TextAlignment="Center"
											   HorizontalAlignment="Center" />
								</DataTemplate>
							</DataGridTemplateColumn.HeaderTemplate>
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="5">
										<Button Content="View"
        Classes="primary"
        Command="{Binding Path=((viewmodels:CustomerPageViewModel)DataContext).ViewPurchaseHistoryCommand, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
        CommandParameter="{Binding Id}"
        FontSize="10"
        Padding="5,2" />
									</StackPanel>
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
						</DataGridTemplateColumn>

					</DataGrid.Columns>
					
				</DataGrid>
			</Border>

			<!-- Form -->
			<Grid Grid.Column="1">
				<Border CornerRadius="10" BoxShadow="0 3 8 0 #3D000000">
					<Grid RowDefinitions="Auto, *, Auto, *">
						<TextBlock Grid.Row="0" Text="Enter Customer Details" HorizontalAlignment="Center"
                                   Margin="0,10,0,0" FontSize="14"
                                   FontFamily="{DynamicResource DmMedium}"
                                   Foreground="{DynamicResource PrimBlack}" />

						<Grid Grid.Row="1" Margin="10" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="Auto,*">
							<!-- ID -->
							<TextBox Text="{Binding Id, Mode=OneWay}" IsVisible="False" />

							<TextBlock Text="First Name:" Classes="UserForm" Grid.Row="0" Grid.Column="0" />
							<TextBox Classes="UserForm" Grid.Row="0" Grid.Column="1"
                                     Text="{Binding FirstName, Mode=TwoWay}" />
							
							<TextBlock Text="Last Name:" Classes="UserForm" Grid.Row="1" Grid.Column="0" />
							<TextBox Classes="UserForm" Grid.Row="1" Grid.Column="1"
                                     Text="{Binding LastName, Mode=TwoWay}" />

							<TextBlock Text="Email:" Classes="UserForm" Grid.Row="2" Grid.Column="0" />
							<TextBox Classes="UserForm" Grid.Row="2" Grid.Column="1"
                                     Text="{Binding Email, Mode=TwoWay}" />

							<TextBlock Text="Phone Number:" Classes="UserForm" Grid.Row="3" Grid.Column="0" />
							<TextBox Classes="UserForm" Grid.Row="3" Grid.Column="1"
                                     Text="{Binding ContactNumber, Mode=TwoWay}" />

							<TextBlock Text="Address:" Classes="UserForm" Grid.Row="4" Grid.Column="0" />
							<TextBox Classes="UserForm" Grid.Row="4" Grid.Column="1"
                                     Text="{Binding Address, Mode=TwoWay}" />
							
							<TextBlock Text="Active" Classes="UserForm" Grid.Row="5" Grid.Column="0" />
							<ComboBox Classes="UserForm"
									  Grid.Row="5" Grid.Column="1"
									  SelectedItem="{Binding IsActive, Mode=TwoWay}"
									  SelectedIndex="0"
									  Height="25"
									  HorizontalAlignment="Stretch"
									  
									  ItemsSource="{Binding BooleanValues}">
								<ComboBox.ItemTemplate>
									<DataTemplate>
										<TextBlock Text="{Binding}" />
									</DataTemplate>
								</ComboBox.ItemTemplate>
								
							</ComboBox>
						</Grid>

						<!-- Action Buttons -->
						<Grid Grid.Row="2" Margin="5,10" HorizontalAlignment="Stretch">
							<Grid.ColumnDefinitions>
								<!-- Define each column separately to make them all equally sized -->
								<ColumnDefinition Width="*" />
								<ColumnDefinition Width="*" />
								<ColumnDefinition Width="*" />
							</Grid.ColumnDefinitions>
							<Button Height="25" FontSize="10" Classes="success" Grid.Column="0" Content="Add"  Command="{Binding AddCustomerCommand}"  HorizontalAlignment="Stretch" />
							<Button Height="25" FontSize="10" Classes="primary" Grid.Column="1" Content="Edit"  Command="{Binding UpdateCustomerCommand}" HorizontalAlignment="Stretch" />
							<Button Height="25" FontSize="10" Classes="danger" Grid.Column="2" Content="Delete"  Command="{Binding RemoveCustomerCommand}" HorizontalAlignment="Stretch"  />
						</Grid>
						<Grid  Grid.Row="3" Margin="5,0,5,10"  >
							<Button HorizontalAlignment="Stretch" Height="25" FontSize="11" Classes="Clear" Grid.Column="0" Content="Clear" Command="{Binding ClearUserFormCommand}" />
						</Grid>
					</Grid>
				</Border>
			</Grid>
		</Grid>
	</StackPanel>
</UserControl>
